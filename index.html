<!DOCTYPE html>
<html>
<head>
  <title>Fonts Demo</title>
  <script src="./font-family/LibFont.js"></script>
  <style>
    .font-radio {
      margin: 3px;
      padding: 3px;
      display: inline-block;
      background-color: aliceblue;
    }

    #font-selection {
      margin-bottom: 35px;
    }

    th {
      text-align: right;
      padding-right: 6px;
    }

    #font-info {
      padding: 3px;
    }

    #font-info,
    .font-radio {
      border-style: solid;
      border-width: 1px;
    }

    #demo > * {
      margin-bottom: 12px;
    }

    #preview-canvas {
      image-rendering: pixelated;
      flex-grow: 0;
      margin-top: 3px;
      padding: 12px;
      border: 1px dashed;
    }

    #text-input {
      width: 100%;
    }
  </style>
  <script>
    const FONT_LIST = [
	"AtaraxiaBold10.font",
	"AtaraxiaBold8.font",
	"AtaraxiaLight10.font",
	"AtaraxiaLight8.font",
	"LucidityBold12.font",
	"LucidityRegular12.font",
	"SangfroidBold10.font",
	"SangfroidRegular10.font",
	"SatoriBold10.font",
	"SatoriMonoBold10.font",
	"SatoriMonoRegular10.font",
	"SatoriRegular10.font",
	"SobrietyBold10.font",
	"SobrietyRegular10.font",
	"SthariaBold10.font",
	"SthariaRegular10.font",
    ];

    window.onload = () => {
      let currentColor = "black";
      const input = document.getElementById("text-input");
      let currentText = input.value;
      const canvas = document.getElementById("preview-canvas");
      const colorInput = document.getElementById("text-color");
      const ctx = canvas.getContext("2d");
      const cursedDemo = document.getElementById("cursed-demo");

      const urlParams = new URLSearchParams(window.location.search);
      const doCursedDemo = !!urlParams.get("cursed");
      if (!doCursedDemo) {
        document.getElementById("demo").style.removeProperty('display');
      }

      let currentFont = null;
      const redrawText = () => {
        const textWidth = currentFont.textWidth(currentText);
        canvas.width = textWidth;
        canvas.height = currentFont.glyphHeight;
        canvas.style.width = `${canvas.width * 2}px`;
        canvas.style.height = `${canvas.height * 2}px`;
        ctx.fillStyle = currentColor;
        currentFont.drawTextInto(ctx, 0, 0, currentText);
      };

      const updateFontInfoTable = (font) => {
        const propMap = {
          "prop-font-name": "name",
          "prop-font-family": "family",
          // 'prop-glyph-count': 'glyphCount',
          "prop-glyph-width": "glyphWidth",
          "prop-glyph-height": "glyphHeight",
          "prop-glyph-spacing": "glyphSpacing",
          "prop-min-glyph-width": "minGlyphWidth",
          "prop-max-glyph-width": "maxGlyphWidth",
          "prop-baseline": "baseline",
          "prop-mean-line": "meanLine",
          "prop-presentation-size": "presentationSize",
          "prop-weight": "weight",
          "prop-slope": "slope",
          "prop-fixed-width": "fixedWidth",
        };
        for (const [id, attr] of Object.entries(propMap)) {
          // Note .innerText seems not to be working in LibWeb
          document.getElementById(id).innerHTML = font[attr];
        }
      };

      const loadSelectedFont = (fontIndex) => {
        const selectedFont = FONT_LIST[fontIndex];
        LibFont.BitmapFont.loadFont(`./font-family/fonts/${selectedFont}`).then((font) => {
          currentFont = font;
          if (!doCursedDemo) {
            redrawText();
            updateFontInfoTable(font);
          } else {
            cursedDemo.innerHTML = '';
            cursedDemo.appendChild(currentFont.getTextAsHTML('Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ac auctor augue mauris augue neque gravida in. Ut tellus elementum sagittis vitae et leo. Eget lorem dolor sed viverra ipsum nunc. Augue neque gravida in fermentum et sollicitudin ac orci. Viverra tellus in hac habitasse platea dictumst vestibulum. Iaculis at erat pellentesque adipiscing commodo elit. Nibh tellus molestie nunc non. Id interdum velit laoreet id donec. Id neque aliquam vestibulum morbi blandit cursus. At quis risus sed vulputate. At augue eget arcu dictum varius duis at consectetur lorem. Vulputate sapien nec sagittis aliquam. Elementum tempus egestas sed sed risus pretium. Enim sit amet venenatis urna cursus eget. Purus viverra accumsan in nisl nisi. Risus feugiat in ante metus. Dignissim sodales ut eu sem integer vitae justo. Blandit massa enim nec dui nunc mattis enim. Nec feugiat nisl pretium fusce id velit ut. Scelerisque mauris pellentesque pulvinar pellentesque habitant morbi. Nulla aliquet enim tortor at auctor urna nunc. Platea dictumst quisque sagittis purus sit amet volutpat. In arcu cursus euismod quis viverra. Tincidunt lobortis feugiat vivamus at augue eget arcu dictum. Elementum nibh tellus molestie nunc non blandit massa enim. Gravida dictum fusce ut placerat orci nulla pellentesque dignissim. Semper eget duis at tellus at. Vitae sapien pellentesque habitant morbi tristique senectus et netus. Magnis dis parturient montes nascetur ridiculus. Urna et pharetra pharetra massa massa. Aliquam sem et tortor consequat id porta nibh. Sagittis nisl rhoncus mattis rhoncus urna neque. Magna ac placerat vestibulum lectus mauris ultrices eros. Erat velit scelerisque in dictum non consectetur. Id diam vel quam elementum pulvinar etiam non quam. Quam vulputate dignissim suspendisse in est. Posuere sollicitudin aliquam ultrices sagittis orci. Vitae semper quis lectus nulla at volutpat diam. Augue mauris augue neque gravida in fermentum et sollicitudin ac. Sed turpis tincidunt id aliquet risus. Magna eget est lorem ipsum dolor sit. Elementum pulvinar etiam non quam lacus suspendisse. Mattis molestie a iaculis at. Neque convallis a cras semper auctor neque vitae tempus. Morbi tristique senectus et netus et.'))
          }
        });
      };

      const radioButtons = document.getElementById("font-selection");
      FONT_LIST.forEach((font, i) => {
        const label = document.createElement("label");
        label.className = "font-radio";
        label.innerText = font;
        label.for = font;
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = "font-select";
        radio.id = font;
        radio.value = i;
        radio.checked = i === 0;
        radio.onchange = (e) => {
          loadSelectedFont(e.target.value | 0);
        };
        label.appendChild(radio);
        radioButtons.appendChild(label);
      });

      input.onkeyup = input.onchange = (e) => {
        if (currentFont) {
          currentText = e.target.value;
          redrawText();
        }
      };

      colorInput.onchange = (e) => {
        console.log(e.target.value)
        if (currentFont) {
          currentColor = e.target.value;
          redrawText();
        }
      }

      loadSelectedFont(0);
    };
  </script>
</head>
<body>
  <h1>Try out a SerenityOS font!</h1>
  <div style="display: flex; flex-direction: column;">
    <div id="font-selection"></div>
    <div id="demo" style="display: none">
      <label for="text-input">Your text:</label>
      <input id="text-input" type="text" value="Well, hello friends!" />
      <label for="text-color">Text color:</label>
      <input type="color" id="text-color" value="#000000">
      <div id="result">
        <canvas width="0" height="0" id="preview-canvas"></canvas>
      </div>
      <div>
        <table id="font-info">
          <tr>
            <th><b>Font name</b></th>
            <td id="prop-font-name"></td>
          </tr>
          <tr>
            <th><b>Font family</b></th>
            <td id="prop-font-family"></td>
          </tr>
          <!-- <tr>
                <th><b>Glyph count</b></th>
                <td id="prop-glyph-count"></td>
            </tr> -->
          <tr>
            <th><b>Glyph width</b></th>
            <td id="prop-glyph-width"></td>
          </tr>
          <tr>
            <th><b>Glyph height</b></th>
            <td id="prop-glyph-height"></td>
          </tr>
          <tr>
            <th><b>Glyph spacing</b></th>
            <td id="prop-glyph-spacing"></td>
          </tr>
          <tr>
            <th><b>Min glyph width</b></th>
            <td id="prop-min-glyph-width"></td>
          </tr>
          <tr>
            <th><b>Max glyph width</b></th>
            <td id="prop-max-glyph-width"></td>
          </tr>
          <tr>
            <th><b>Baseline</b></th>
            <td id="prop-baseline"></td>
          </tr>
          <tr>
            <th><b>Mean line</b></th>
            <td id="prop-mean-line"></td>
          </tr>
          <tr>
            <th><b>Presentation size</b></th>
            <td id="prop-presentation-size"></td>
          </tr>
          <tr>
            <th><b>Weight</b></th>
            <td id="prop-weight"></td>
          </tr>
          <tr>
            <th><b>Slope</b></th>
            <td id="prop-slope"></td>
          </tr>
          <tr>
            <th><b>Fixed width?</b></th>
            <td id="prop-fixed-width"></td>
          </tr>
        </table>
      </div>
      <hr>
      <div style="width: 100%; font-size: 20px;">
        <a href="?cursed=1">Text wrapping demo</a>
      </div>
    </div>
  </div>
  <div id="cursed-demo"></div>
</body>
</html>
